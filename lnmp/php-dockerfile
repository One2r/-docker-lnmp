FROM php:7.4-fpm

LABEL maintainer="1972871083@qq.com"

ENV LANG C.UTF-8
ENV TZ=Asia/Shanghai

RUN apt-get update && apt-get install -y procps \
    build-essential \
    unzip \
    bzip2 \
    libxml2 \
    apt-utils \
    gcc \
	libjpeg-dev \
    libpng-dev \
	libonig-dev \
	libfreetype6-dev \
	libbz2-dev \
	libzip-dev \
	libldap2-dev \
	zlib1g-dev \
	libxml2-dev \
	libcurl4-openssl-dev
	
RUN /usr/local/bin/docker-php-ext-install gd
RUN /usr/local/bin/docker-php-ext-install xml
RUN /usr/local/bin/docker-php-ext-install gettext
RUN /usr/local/bin/docker-php-ext-install zip
RUN /usr/local/bin/docker-php-ext-install ldap
RUN /usr/local/bin/docker-php-ext-install pdo_mysql
RUN /usr/local/bin/docker-php-ext-install mbstring
RUN /usr/local/bin/docker-php-ext-install bcmath
RUN /usr/local/bin/docker-php-ext-install opcache

RUN pecl install http://pecl.php.net/get/redis-5.3.7.tgz && docker-php-ext-enable redis
RUN pecl install http://pecl.php.net/get/psr-1.2.0.tgz && docker-php-ext-enable psr
RUN pecl install http://pecl.php.net/get/phalcon-4.1.2.tgz && docker-php-ext-enable phalcon

COPY --from=rust /usr/local/cargo/ /usr/local/cargo
ENV CARGO_HOME=/usr/local/cargo
ENV RUSTUP_HOME=/usr/local/cargo
ENV PATH=/usr/local/cargo/bin:$PATH
RUN pecl install http://pecl.php.net/get/skywalking-5.0.1.tgz && docker-php-ext-enable skywalking