version: '1'
name: lnmp
services:
  nginx:
    image: 'nginx:stable'
    privileged: true
    volumes:
      - ./etc/nginx/conf.d:/etc/nginx/conf.d:ro
      - ./var/log/nginx:/var/log/nginx:rw
      - ./data/www:/usr/share/nginx/html:rw
    depends_on:
      - php
    networks:
      dev:
        ipv4_address: 172.32.1.2
    restart: always
    environment:
      - TZ=Asia/Shanghai
    ports:
      - "80:80"
 
  php:
    image: 'php:7.4-fpm-phalcon'    
    privileged: true
    volumes:
      - ./etc/php/php.ini:/usr/local/etc/php/php.ini:ro
      - ./etc/php/php-fpm.conf:/usr/local/etc/php-fpm.conf:ro
      - ./etc/php/www.conf:/usr/local/etc/php-fpm.d/www.conf:ro
      - ./var/log/php:/var/log/php:rw
      - ./data/www:/www:rw
    external_links:
      - skywalking-oap-server:skywalking-oap
    networks:
      dev:
        ipv4_address: 172.32.1.3
    restart: always
    environment:
      - TZ=Asia/Shanghai
        
  redis:
    image: 'redis:6'
    privileged: true
    volumes:
      - ./etc/redis/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - ./data/redis/:/data:rw
    networks:
      dev:
        ipv4_address: 172.32.1.4
    restart: always
    environment:
      - TZ=Asia/Shanghai
    ports:
      - "6379:6379"
    command: ["redis-server","/usr/local/etc/redis/redis.conf"]
 
networks:
  dev:
    external: true
